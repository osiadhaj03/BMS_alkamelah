# ๐ ุฏููู ุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช - ูุธุงู ุงูููุชุจุฉ ุงููุงููุฉ (BMS)

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ:** 2026-01-18  
**ุงูุฅุตุฏุงุฑ:** 2.0  
**ุงูุบุฑุถ:** ุฏููู ุดุงูู ูุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุณุงุนุฏุฉ ูู ุฅูุดุงุก ุณูุฑุจุชุงุช ุณุญุจ ุงููุชุจ

---

## ๐ ูุธุฑุฉ ุนุงูุฉ ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฅุญุตุงุฆูุงุช ุงูุฑุฆูุณูุฉ

| ุงูููุงู | ุงูุนุฏุฏ |
|--------|-------|
| ุงููุชุจ | 12,009 |
| ุงููุคูููู | 3,622 |
| ุงูุตูุญุงุช | 5,024,544 |
| ุงููุตูู | 1,638,726 |
| ุงููุฌูุฏุงุช | 22,269 |
| ุฏูุฑ ุงููุดุฑ | 1,710 |
| ุงูุฃูุณุงู | 40 |

### ุงููููู ุงููุฑูู ููุจูุงูุงุช

```
book_sections (ุงูุฃูุณุงู)
    โ
books (ุงููุชุจ)
    โ
volumes (ุงููุฌูุฏุงุช)
    โ
chapters (ุงููุตูู)
    โ
pages (ุงูุตูุญุงุช)
```

---

## ๐๏ธ ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ

### 1๏ธโฃ ุฌุฏูู `books` - ุงููุชุจ

| ุงูุญูู | ุงูููุน | ุฅูุฒุงูู | ุงููุตู |
|------|------|--------|-------|
| `id` | bigint | โ | ุงููุนุฑู ุงููุฑูุฏ (PK) |
| `shamela_id` | varchar(50) | โ | ูุนุฑู ุงููุชุงุจ ูู ุงูุดุงููุฉ/ุงููุตุฏุฑ ุงูุฎุงุฑุฌู |
| `title` | varchar(255) | โ | ุนููุงู ุงููุชุงุจ |
| `description` | text | โ | ูุตู ุงููุชุงุจ |
| `visibility` | enum | โ | `public`, `private`, `restricted` |
| `is_reviewed` | boolean | โ | ุชู ูุฑุงุฌุนุชู |
| `reviewed_by` | varchar(255) | โ | ุงููุณุชุฎุฏู ุงูุฐู ูุงู ุจุงููุฑุงุฌุนุฉ |
| `book_section_id` | bigint | โ | FK โ `book_sections.id` |
| `publisher_id` | bigint | โ | FK โ `publishers.id` |
| `has_original_pagination` | boolean | โ | ูู ูู ุชุฑููู ุฃุตูู |
| `additional_notes` | text | โ | ููุงุญุธุงุช ุฅุถุงููุฉ |

---

### 2๏ธโฃ ุฌุฏูู `authors` - ุงููุคูููู

| ุงูุญูู | ุงูููุน | ุฅูุฒุงูู | ุงููุตู |
|------|------|--------|-------|
| `id` | bigint | โ | ุงููุนุฑู ุงููุฑูุฏ (PK) |
| `full_name` | varchar(255) | โ | ุงูุงุณู ุงููุงูู (ูุฑูุฏ) |
| `first_name` | varchar(100) | โ | ุงูุงุณู ุงูุฃูู |
| `middle_name` | varchar(100) | โ | ุงูุงุณู ุงูุฃูุณุท |
| `last_name` | varchar(100) | โ | ุงุณู ุงูุนุงุฆูุฉ |
| `laqab` | varchar(100) | โ | ุงูููุจ (ุงูุฅูุงูุ ุงูุญุงูุธ) |
| `kunyah` | varchar(100) | โ | ุงููููุฉ (ุฃุจู ุนุจุฏ ุงููู) |
| `biography` | text | โ | ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ |
| `image` | varchar(255) | โ | ุตูุฑุฉ ุงููุคูู |
| `madhhab` | enum | โ | ุงููุฐูุจ ุงููููู |
| `is_living` | boolean | โ | ุนูู ููุฏ ุงูุญูุงุฉ |
| `birth_date` | date | โ | ุชุงุฑูุฎ ุงููููุงุฏ |
| `death_date` | date | โ | ุชุงุฑูุฎ ุงูููุงุฉ |

**ุงูููู ุงููุณููุญุฉ ูู `madhhab`:**
`ุงููุฐูุจ ุงูุญููู`, `ุงููุฐูุจ ุงููุงููู`, `ุงููุฐูุจ ุงูุดุงูุนู`, `ุงููุฐูุจ ุงูุญูุจูู`, `ุขุฎุฑูู`

---

### 3๏ธโฃ ุฌุฏูู `author_book` - ุฑุจุท ุงููุคูููู ุจุงููุชุจ (Pivot)

| ุงูุญูู | ุงูููุน | ุฅูุฒุงูู | ุงููุตู |
|------|------|--------|-------|
| `id` | bigint | โ | ุงููุนุฑู ุงููุฑูุฏ (PK) |
| `book_id` | bigint | โ | FK โ `books.id` |
| `author_id` | bigint | โ | FK โ `authors.id` |
| `role` | enum | โ | ุฏูุฑ ุงููุคูู |
| `is_main` | boolean | โ | ูุคูู ุฑุฆูุณู |
| `display_order` | int | โ | ุชุฑุชูุจ ุงูุนุฑุถ |

**ุงูููู ุงููุณููุญุฉ ูู `role`:**

- `author` - ูุคูู
- `co_author` - ูุคูู ูุดุงุฑู
- `editor` - ูุญูู
- `translator` - ูุชุฑุฌู
- `reviewer` - ูุฑุงุฌุน
- `commentator` - ูุนูู

---

### 4๏ธโฃ ุฌุฏูู `book_sections` - ุฃูุณุงู ุงููุชุจ

| ุงูุญูู | ุงูููุน | ุฅูุฒุงูู | ุงููุตู |
|------|------|--------|-------|
| `id` | bigint | โ | ุงููุนุฑู ุงููุฑูุฏ (PK) |
| `name` | varchar(255) | โ | ุงุณู ุงููุณู |
| `description` | text | โ | ูุตู ุงููุณู |
| `parent_id` | bigint | โ | FK โ `book_sections.id` (self-ref) |
| `sort_order` | int | โ | ุชุฑุชูุจ ุงูุนุฑุถ |
| `is_active` | boolean | โ | ูุดุท |
| `logo_path` | varchar(500) | โ | ูุณุงุฑ ุงูุดุนุงุฑ |

---

### 5๏ธโฃ ุฌุฏูู `volumes` - ุงููุฌูุฏุงุช

| ุงูุญูู | ุงูููุน | ุฅูุฒุงูู | ุงููุตู |
|------|------|--------|-------|
| `id` | bigint | โ | ุงููุนุฑู ุงููุฑูุฏ (PK) |
| `book_id` | bigint | โ | FK โ `books.id` |
| `number` | int | โ | ุฑูู ุงููุฌูุฏ |
| `title` | varchar(255) | โ | ุนููุงู ุงููุฌูุฏ |
| `page_start` | int | โ | ุฑูู ุงูุตูุญุฉ ุงูุฃููู |
| `page_end` | int | โ | ุฑูู ุงูุตูุญุฉ ุงูุฃุฎูุฑุฉ |

**ููุฏ ูุฑูุฏ:** `(book_id, number)`

---

### 6๏ธโฃ ุฌุฏูู `chapters` - ุงููุตูู ูุงูุฃุจูุงุจ

| ุงูุญูู | ุงูููุน | ุฅูุฒุงูู | ุงููุตู |
|------|------|--------|-------|
| `id` | bigint | โ | ุงููุนุฑู ุงููุฑูุฏ (PK) |
| `book_id` | bigint | โ | FK โ `books.id` |
| `volume_id` | bigint | โ | FK โ `volumes.id` |
| `title` | varchar(255) | โ | ุนููุงู ุงููุตู |
| `parent_id` | bigint | โ | FK โ `chapters.id` (self-ref) |
| `level` | int | โ | ูุณุชูู ุงูุชุฏุงุฎู (1, 2, 3...) |
| `order` | bigint | โ | ุชุฑุชูุจ ุงููุตู |
| `page_start` | int | โ | ุฑูู ุงูุตูุญุฉ ุงูุฃููู |
| `page_end` | int | โ | ุฑูู ุงูุตูุญุฉ ุงูุฃุฎูุฑุฉ |

---

### 7๏ธโฃ ุฌุฏูู `pages` - ุงูุตูุญุงุช

| ุงูุญูู | ุงูููุน | ุฅูุฒุงูู | ุงููุตู |
|------|------|--------|-------|
| `id` | bigint | โ | ุงููุนุฑู ุงููุฑูุฏ (PK) |
| `book_id` | bigint | โ | FK โ `books.id` |
| `volume_id` | bigint | โ | FK โ `volumes.id` |
| `chapter_id` | bigint | โ | FK โ `chapters.id` |
| `page_number` | int | โ | ุฑูู ุงูุตูุญุฉ |
| `internal_index` | varchar(50) | โ | ููุฑุณ ุฏุงุฎูู |
| `part` | varchar(255) | โ | ุงูุฌุฒุก |
| `content` | longtext | โ | ุงููุญุชูู ุงููุตู |
| `html_content` | longtext | โ | ุงููุญุชูู HTML |
| `original_page_number` | int | โ | ุฑูู ุงูุตูุญุฉ ุงูุฃุตูู |

> **โ๏ธ ุชุญุฐูุฑ:** ูุฐุง ุงูุฌุฏูู ุถุฎู (18 GB) - ุงุณุชุฎุฏู Batch Insert ุฏุงุฆูุงู

---

### 8๏ธโฃ ุฌุฏูู `publishers` - ุฏูุฑ ุงููุดุฑ

| ุงูุญูู | ุงูููุน | ุฅูุฒุงูู | ุงููุตู |
|------|------|--------|-------|
| `id` | bigint | โ | ุงููุนุฑู ุงููุฑูุฏ (PK) |
| `name` | varchar(255) | โ | ุงุณู ุงููุงุดุฑ |
| `address` | varchar(255) | โ | ุงูุนููุงู |
| `country` | varchar(100) | โ | ุงูุจูุฏ |
| `email` | varchar(255) | โ | ุงูุจุฑูุฏ ุงูุฅููุชุฑููู |
| `phone` | varchar(255) | โ | ุงููุงุชู |
| `description` | text | โ | ุงููุตู |
| `website_url` | varchar(255) | โ | ุงููููุน ุงูุฅููุชุฑููู |
| `is_active` | boolean | โ | ูุดุท (ุงูุชุฑุงุถู: true) |

---

## ๐ ูุฎุทุท ุงูุนูุงูุงุช (ERD)

```
โโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโ
โ book_sections โโโโโโโโโโโ    books    โ
โ   (40)        โ         โ  (12,009)   โ
โโโโโโโโโฌโโโโโโโโ         โโโโโโโโฌโโโโโโโ
        โ parent_id              โ
        โโโโโโโโโโโโโโ           โ
                     โ     โโโโโโโผโโโโโโโโโโโโโโ
                     โ     โ     โ             โ
                โโโโโโผโโโโโโโโโโโโผโโโโโ โโโโโโโโผโโโโโโโ
                โpublishersโโโvolumes  โ โauthor_book  โ
                โ  (1,710)โโโ (22,269)โ โ   (3,816)   โ
                โโโโโโโโโโโโโโโโโโฌโโโโโ โโโโโโโโฌโโโโโโโ
                           โ     โ             โ
                           โโโโโโโผโโโโโ  โโโโโโโผโโโโโโ
                           โโchapters โ  โ  authors  โ
                           โโ(1.6M)   โ  โ  (3,622)  โ
                           โโโโโโโฌโโโโโ  โโโโโโโโโโโโโ
                           โ     โ
                           โโโโโโโผโโโโโ
                           โโ  pages  โ
                           โโ  (5M)   โ
                           โโโโโโโโโโโโ
```

---

## ๐ ุฃูุซูุฉ ุนูู ุงูุฅุฏุฎุงู

### ุฅุถุงูุฉ ูุชุงุจ ูุงูู

```php
use App\Models\{Book, Author, Volume, Chapter, Page};
use Illuminate\Support\Facades\DB;

DB::transaction(function () {
    // 1. ุฅูุดุงุก ุงููุชุงุจ
    $book = Book::create([
        'title' => 'ุตุญูุญ ุงูุจุฎุงุฑู',
        'shamela_id' => '12345',
        'visibility' => 'public',
        'status' => 'published',
        'book_section_id' => 5,
    ]);
    
    // 2. ุงูุจุญุซ ุนู ุงููุคูู ุฃู ุฅูุดุงุคู
    $author = Author::firstOrCreate(
        ['full_name' => 'ูุญูุฏ ุจู ุฅุณูุงุนูู ุงูุจุฎุงุฑู'],
        ['is_living' => false, 'madhhab' => 'ุงููุฐูุจ ุงูุดุงูุนู']
    );
    
    // 3. ุฑุจุท ุงููุคูู ุจุงููุชุงุจ
    $book->authors()->attach($author->id, [
        'role' => 'author',
        'is_main' => true,
        'display_order' => 1
    ]);
    
    // 4. ุฅูุดุงุก ุงููุฌูุฏุงุช
    for ($i = 1; $i <= 9; $i++) {
        Volume::create([
            'book_id' => $book->id,
            'number' => $i,
        ]);
    }
    
    // 5. ุฅุถุงูุฉ ุงูุตูุญุงุช ุจุงูุฏูุนุงุช
    $pages = [];
    foreach ($pagesData as $pageData) {
        $pages[] = [
            'book_id' => $book->id,
            'page_number' => $pageData['page'],
            'content' => $pageData['text'],
            'created_at' => now(),
            'updated_at' => now(),
        ];
        
        if (count($pages) >= 500) {
            Page::insert($pages);
            $pages = [];
        }
    }
    if (!empty($pages)) {
        Page::insert($pages);
    }
});
```

---

## ๐ฏ ูุตุงุฆุญ ููุณูุฑุจุช

### 1. ุงุณุชุฎุฏู Transactions

```php
DB::transaction(function () {
    // ุฌููุน ุนูููุงุช ุงูุฅุฏุฎุงู ููุง
});
```

### 2. ุงุณุชุฎุฏู Batch Insert ููุตูุญุงุช

```php
// โ ุจุทูุก
foreach ($pages as $page) {
    Page::create($page);
}

// โ ุณุฑูุน
Page::insert($pages);
```

### 3. ุฒูุงุฏุฉ ุญุฏ ุงูุฐุงูุฑุฉ ูุงูููุช

```php
ini_set('memory_limit', '512M');
set_time_limit(3600);
```

### 4. ุงูุชุญูู ูู ุงูุชูุฑุงุฑ

```php
$existingBook = Book::where('shamela_id', $externalId)->first();
if ($existingBook) {
    // ุงููุชุงุจ ููุฌูุฏ ูุณุจูุงู
    return;
}
```

---

## ๐ ูุตุงุฏุฑ ุฅุถุงููุฉ

- [DATABASE_REPORT.md](file:///c:/Users/osaid/Documents/BMS_alkamelah/doc/dataBase/DATABASE_REPORT.md) - ุชูุฑูุฑ ุชุญููู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- [DATABASE_REBUILD_PLAN.md](file:///c:/Users/osaid/Documents/BMS_alkamelah/doc/dataBase/DATABASE_REBUILD_PLAN.md) - ุฎุทุฉ ุฅุนุงุฏุฉ ุจูุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
- [SCRAPER_INTEGRATION_PLAN.md](file:///c:/Users/osaid/Documents/BMS_alkamelah/doc/scraper/SCRAPER_INTEGRATION_PLAN.md) - ุฎุทุฉ ุฏูุฌ ุงูุณูุฑุจุช

---

**ุชู ุฅูุดุงุก ูุฐุง ุงูุฏููู ุจุชุงุฑูุฎ:** 2026-01-18
